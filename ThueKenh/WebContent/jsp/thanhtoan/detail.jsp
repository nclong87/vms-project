<%@ page language="java" contentType="text/html; charset=UTF-8"	pageEncoding="UTF-8"%><%@ taglib prefix="s" uri="/struts-tags"%><s:url action="findphulucByhopdonganddoisoatcuoc" namespace="/phuluc" id="findphulucByhopdonganddoisoatcuocURL" /><s:url action="findByDoiSoatCuoc" namespace="/sucokenh" id="findsucoByDoiSoatCuocURL" /><s:url action="detail" namespace="/phuluc" id="detailPhuLucURL"/><s:url action="loadformbydoisoatcuoc" namespace="/thanhtoan" id="loadformbydoisoatcuocURL"/><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><%	String contextPath = request.getContextPath();%><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="description" content="Reflect Template" /><meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" /><title>Xem chi tiết hồ sơ thanh toán : <s:property value="detail.sohoso"/></title><link rel="stylesheet" href="<%= contextPath %>/css/detailpage.css" type="text/css" media="screen" /><link rel="stylesheet" href="<%= contextPath %>/css/cupertino/jquery-ui.css" type="text/css" media="screen" /><link rel="stylesheet" href="<%= contextPath %>/css/demo_table_jui.css" /><script>var contextPath = '<%= contextPath %>';var baseUrl = contextPath;function byId(id) { //Viet tat cua ham document.getElementById	return document.getElementById(id);}</script><script type='text/javascript' src='<%= contextPath %>/js/jquery.js'></script><script type='text/javascript' src='<%= contextPath %>/js/jquery-ui.js'></script><script type="text/javascript" src="<%=contextPath%>/js/jquery.validate.js"></script><script type="text/javascript" src="<%=contextPath%>/js/mylibs/my.validate.js"></script><script type="text/javascript" src="<%= contextPath %>/js/jquery.dataTables.min.js"></script><script type="text/javascript" src="<%=contextPath%>/js/mylibs/popup_search.js"></script><script type="text/javascript" src="<%=contextPath%>/js/jquery.formatCurrency.min.js"></script><script type='text/javascript' src='<%= contextPath %>/js/utils.js'></script><style>	.ui-icon{		background: none !important;	}	.hopdonginfo	{		position: absolute;    	left: 185px;    	top: 3px;	}	.hopdonginfo td	{		padding: 0;    	width: 210px;	}	.ui-accordion .ui-accordion-content-active	{		height:auto !important;	}	#dataTable	{		font-family:arial !important;		font-size: 12px !important;		color:black !important;	}</style></head><body>	<input type="text" style="display: none" name="doisoatcuoc_id" id="doisoatcuoc_id" />	<div id="bg_wrapper">		<h3>THÔNG TIN CHI TIẾT HỒ SƠ THANH TOÁN</h3>		<dt>Số hồ sơ :</dt>		<dd><s:property value="detail.sohoso"/></dd>		<dt>Trạng thái :</dt>		<dd id="trangthai"></dd>		<dt>Tháng/Năm thanh toán :</dt>		<dd><s:property value="detail.thang"/>/<s:property value="detail.nam"/></dd>		<dt>Ngày chuyển hồ sơ kế toán :</dt>		<dd><s:property value="detail.ngaychuyenkt"/></dd>		<dt>Ngày ký ủy nhiệm chi :</dt>		<dd><s:property value="detail.ngaykyunc"/>&nbsp;</dd>		<dt>Ngày chuyển khoản :</dt>		<dd><s:property value="detail.ngaychuyenkhoan"/>&nbsp;</dd>		<dt>Số tiền giảm trừ :</dt>		<dd><s:property value="detail.giamtrumll"/></dd>		<dt>Giá trị thanh toán :</dt>		<dd><s:property value="detail.thanhtien"/></dd>		<dt>File scan :</dt>		<dd>			<a href="/upload/<s:property value='detail.filepath'/>" target="_blank"><s:property value='detail.filename'/></a>		</dd>		<dt>Danh sách hợp đồng :</dt>		<dd>			<div id="tab"></div>		</dd>		<dt>Danh sách sự cố giảm trừ :</dt>		<dd>			<table width="100%" id="dataTable" class="display">				<thead>					<tr>						<th width="3px">STT</th>						<th width="30px">Mã tuyến kênh</th>						<th width="50px">Mã điểm đầu</th>						<th width="50px">Mã điểm cuối</th>						<th width="50px">Giao tiếp</th>						<th width="50px">Dung lượng</th>						<th width="100px">Thời gian bắt đầu</th>						<th width="100px">Thời gian kết thúc</th>						<th width="50px">Thời gian mất liên lạc</th>						<th width="200px">Nguyên nhân</th>						<th width="100px">Phương án xử lý</th>						<th width="50px">Người xác nhận</th>						<th width="50px">Người tạo</th>						<th width="50px">Ngày tạo</th>					</tr>				</thead>				<tbody>										</tbody>			</table>		</dd>	</div></body></html><script>function addRow(stt,data) {	oTable.fnAddData([		stt,data.tuyenkenh_id,'<center>'+data.madiemdau+'</center>','<center>'+data.madiemcuoi+'</center>','<center>'+data.loaigiaotiep+'</center>','<center>'+data.dungluong+' MB</center>','<center>'+data.thoidiembatdau+'</center>','<center>'+data.thoidiemketthuc+'</center>','<center>'+data.thoigianmll+'</center>',data.nguyennhan,data.phuonganxuly,'<center>'+data.nguoixacnhan+'</center>','<center>'+data.usercreate+'</center>',data.timecreate+'<input type="text" style="display:none" name="suco_ids" value="'+data.id+'" id="suco_id_'+data.id+'"/>'	]);}function addphuluc(obj,stt,data){	var thanhtoan="";	if(data.thang!="" && data.nam!="")		thanhtoan="Đã thanh toán đến tháng "+data.thang+"/"+data.nam;	else		thanhtoan="Chưa thanh toán";	var loaiphuluc="";	if(data.loaiphuluc==1)		loaiphuluc="Độc lập";	else 		loaiphuluc="Thay thế";	var trangthai = "";	if(data.phulucbithaythe!="<root></root>")		$.each(data.phulucbithaythe,function(){			trangthai+='Thay thế cho các phụ lục: <a href="${detailPhuLucURL}?id='+this.id+'" title="'+this.tenphuluc+'">'+this.tenphuluc.vmsSubstr(20)+"</a><br>";		});	obj.fnAddData([		'<center>'+stt+'</center>',data.tenphuluc,'<center>'+loaiphuluc+'/<center>','<center>'+data.tendoitac+'</center>','<center>'+data.soluongkenh+'</center>','<center class="currency">'+data.giatritruocthue+'</center>','<center class="currency">'+data.giatrisauthue+'</center>','<center>'+data.ngayhieuluc+'</center>','<center>'+trangthai+'</center>','<center>'+thanhtoan+'</center>'	]);}function addhopdong(container,data,i){	var loaihopdong="Có thời hạn";	if(data.loaihopdong==1)		loaihopdong="Có thời hạn";	else 		loaihopdong="Không có thời hạn";	var rowhopdong=  '<h3 class="div_'+data.id+'"><a href="#" style="text-align:left !important; margin-left:15px">Số hợp đồng: '+data.sohopdong+'</a><table class="hopdonginfo"><tr><td>Loại hợp đồng: '+loaihopdong+'</td><td>Đối tác: '+data.tendoitac+'</td><td>Ngày ký: '+data.ngayky+'</td><td>Ngày hết hạn: '+data.ngayhethan+'</td></tr></table></h3>'					+'<div class="div_'+data.id+' listphuluc">'						+'<input id="hopdong_id" style="display:none" value="'+data.id+'"/>'						+'<input id="sohopdong" style="display:none" value="'+data.sohopdong+'"/>'						+'<table width="100%" class="display" id="datatable_'+data.id+'">'							+'<thead>'								+'<tr>'									+'<th style="width:30px">STT</th>'									+'<th>Tên phụ lục</th>'									+'<th>Loại phụ lục</th>'									+'<th>Đối tác</th>'									+'<th>Số lượng kênh</th>'									+'<th>Giá trị trước thuế</th>'									+'<th>Giá trị sau thuế</th>'									+'<th>Ngày hiệu lực</th>'									+'<th>Trạng thái</th>'									+'<th>Thanh toán</th>'								+'</tr>'							+'</thead>'								+'<tbody>'							+'</tbody>'						+'</table>'							+'</div>';	container.append(rowhopdong);}function LoadHopDongEdit(data){	$("#tab").html("");	var div=document.createElement("div");	$(div).attr("id","accordion");	$(data).each(function(){		addhopdong($(div),this);	});		$("#tab").append(div);	$(div).accordion();	$(".del").click(function(){		var id=$(this).attr("id");		$(".div_"+id).remove();	});	$(data).each(function(){		var oPLtable=$('#datatable_'+this.id).dataTable({			"bJQueryUI": true,			"bProcessing": false,			"bScrollCollapse": true,			"bAutoWidth": true,			"bSort":false,			"bFilter": false,"bInfo": false,			"bPaginate" : false,			"sAjaxSource": "${findphulucByhopdonganddoisoatcuocURL}?hopdong_id="+this.id+"&doisoatcuoc_id="+$("#doisoatcuoc_id").val(),			"aoColumns": null,			"fnServerData": function ( sSource, aoData, fnCallback ) {				$.ajax( {					"dataType": 'json', 					"type": "POST", 					"url": sSource, 					"data": aoData, 					"success": function(response){						if(response.result == "ERROR") {							alert("Lỗi kết nối server, vui lòng thử lại.");						} else {							if(response.aaData.length != 0) {								var i = 0;								$.each(response.aaData,function(){									addphuluc(oPLtable,i+1,this);									i++;								});								$(".currency,#giatritt").formatCurrency({ 									region : 'vn',									roundToDecimalPlace: 0, 									eventOnDecimalsEntered: true 								});							} else {								oPLtable.fnAddData([0,'','','','','','','','','']);								oPLtable.fnDeleteRow(0);							}						}					}				} );			}		});	});}function LoadInfo(id,thanhtien,tungay){	oTable.fnClearTable();	$("#doisoatcuoc_id").val(id);	$("#giatritt").val(thanhtien);	$("#giatritt").attr("disabled","disabled");	tungay=tungay.replace(" 00:00:00.0","");	tungay=tungay.split("-");	if(tungay.length>=3)	{		$("#thang").val(tungay[1]);		$("#thang").attr("disabled","disabled");		$("#nam").val(tungay[0]);		$("#nam").attr("disabled","disabled");	}	$.ajax( {		"dataType": 'json', 		"type": "POST", 		"url": "${loadformbydoisoatcuocURL}", 		"data": "doisoatcuoc_id="+id, 		"success": function(response){			if(response.result == "ERROR") {				alert("Lỗi kết nối server, vui lòng thử lại.");			} else {				if(response.phuluc_hopdongs.length!=0)				{					var phuluc_hopdong=$.parseJSON(response.phuluc_hopdongs);					LoadHopDongEdit(phuluc_hopdong);				}				// load su co				if(response.sucos.length != 0) {					var i = 0;					$.each(response.sucos,function(){						addRow(i+1,this);						i++;					});				} else {					oTable.fnAddData([0,'','','','','','','','','','','','','']);					oTable.fnDeleteRow(0);				}			}		}	});}$(document).ready(function() {	var trangthai=<s:property value="detail.trangthai"/>;	if(trangthai==0)		$("#trangthai").text("Chưa thanh toán");	else		$("#trangthai").text("Đã thanh toán");	oTable = $('#dataTable').dataTable({		"bJQueryUI": true,		"bProcessing": false,		"bScrollCollapse": true,		"bAutoWidth": true,		"bSort":false,		"bFilter": false,"bInfo": false,		"bPaginate" : false	});		var doisoatcuoc_id=<s:property value="detail.doisoatcuoc_id"/>;	$("#doisoatcuoc_id").val(doisoatcuoc_id);	var thanhtien=<s:property value="detail.thanhtien"/>;	var tungay='<s:property value="detail.tungay"/>';	LoadInfo(doisoatcuoc_id,thanhtien,tungay);});</script>