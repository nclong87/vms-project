<%@ page language="java" contentType="text/html; charset=UTF-8"	pageEncoding="UTF-8"%><%@ taglib prefix="s" uri="/struts-tags"%><s:url action="findTuyenKenhByPhuLuc" namespace="/ajax" id="findTuyenKenhByPhuLucURL" /><s:url action="findTuyenKenhByChiTietPhuLuc" namespace="/ajax" id="findTuyenKenhByChiTietPhuLucURL" /><s:url action="detail" namespace="/hopdong" id="detailHopDongURL"/>	<s:url action="detail" namespace="/phuluc" id="detailPhuLucURL"/>	<s:url action="detail" namespace="/tuyenkenh" id="detailTuyenKenhURL"/>	<s:url action="lichSuPhuLuc" namespace="/ajax" id="lichSuPhuLucURL"/>	<s:url action="detail" namespace="/thanhtoan" id="detailThanhToanURL" /><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><%	String contextPath = request.getContextPath();%><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="description" content="Reflect Template" /><meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" /><title>Xem chi tiết phụ lục : <s:property value="json.tenphuluc"/></title><link rel="stylesheet" href="<%= contextPath %>/css/detailpage.css" type="text/css" media="screen" /><link rel="stylesheet" href="<%= contextPath %>/css/cupertino/jquery-ui.css" type="text/css" media="screen" /><link rel="stylesheet" href="<%= contextPath %>/css/demo_table_jui.css" /><script type="text/javascript" src="<%=contextPath%>/js/mylibs/history.js"></script><script>var contextPath = '<%= contextPath %>';var baseUrl = contextPath;function byId(id) { //Viet tat cua ham document.getElementById	return document.getElementById(id);}</script><script type='text/javascript' src='<%= contextPath %>/js/jquery.js'></script><script type="text/javascript" src="<%=contextPath%>/js/trangthai_utils.js"></script><script type='text/javascript' src='<%= contextPath %>/js/jquery-ui.js'></script><script type='text/javascript' src='<%= contextPath %>/js/jquery.dataTables.min.js'></script><script type='text/javascript' src='<%= contextPath %>/js/jquery.formatCurrency.min.js'></script><script type="text/javascript" src="<%= contextPath %>/js/utils.js"></script><style>.dataTables_wrapper .ui-toolbar {  display: none;  padding: 5px;}</style></head><body>	<div id="bg_wrapper">		<h3>THÔNG TIN CHI TIẾT PHỤ LỤC</h3>		<dt>Số phụ lục :</dt>		<dd><s:property value="json.tenphuluc"/>&nbsp;</dd>		<dt>Số hợp đồng :</dt>		<dd><a href="${detailHopDongURL}?id=<s:property value='json.hopdong_id'/>" title=""><s:property value="json.sohopdong"/></a>&nbsp;</dd>		<dt>Loại phụ lục :</dt>		<dd id="loaiphuluc">		<s:if test="json.loaiphuluc==1">			Độc lập</dd>		</s:if>		<s:else>			Thay thế</dd>		<dt>Thay thế cho các phụ lục sau :</dt>		<dd>		<ul style="margin: 0px; padding-left: 15px;">		<s:iterator value="json.phulucbithaythe">			<li><a href="${detailPhuLucURL}?id=<s:property value='id' />"><s:property value='tenphuluc' /></a></li>		</s:iterator>		</ul>&nbsp;</dd>		</s:else>		<dt>Số lượng kênh :</dt>		<dd><s:property value="json.soluongkenh"/>&nbsp;</dd>		<dt>Thành tiền trước thuế :</dt>		<dd class="number"><s:property value="json.giatritruocthue"/>&nbsp;</dd>		<dt>Thành tiền sau thuế :</dt>		<dd class="number"><s:property value="json.giatrisauthue"/>&nbsp;</dd>		<dt>Cước đấu nối hòa mạng :</dt>		<dd class="number"><s:property value="json.cuocdaunoi"/>&nbsp;</dd>		<dt>Ngày ký :</dt>		<dd><s:property value="json.ngayky"/>&nbsp;</dd>		<dt>Ngày có hiệu lực :</dt>		<dd><s:property value="json.ngayhieuluc"/>&nbsp;</dd>		<dt>Ngày hết hiệu lực :</dt>		<dd><s:property value="json.ngayhethieuluc"/>&nbsp;</dd>		<dt>Đã thanh toán đến :</dt>		<dd><s:property value="json.thang"/>/<s:property value="json.nam"/>&nbsp;</dd>		<dt>File Scan :</dt>		<dd><a href='/upload/<s:property value="json.filepath"/>' title="Tải bản cứng phụ lục"><s:property value="json.filename"/></a>&nbsp;</dd>		<dt>Danh sách tuyến kênh thuộc phụ lục:</dt>		<dd>			<table width="100%" id="dataTable" class="display">			<thead>				<tr>					<th width="5%" align="center">#</th>					<th>Mã kênh</th>					<th>Mã điểm đầu</th>					<th>Mã điểm cuối</th>					<th>Giao tiếp</th>					<th>Dung lượng</th>					<th>Số lượng</th>				</tr>			</thead>			<tbody>							</tbody>			</table>		</dd>		<dt>Thông tin lịch sử :</dt>		<dd>			<ul id="history">						</ul>			<span id="load_more" title="Xem dữ liệu lịch sử cũ hơn" onclick="loadHistory()">Xem thêm...</span>		</dd>	</div></body></html><script>var phuluc_id = '<s:property value="json.id"/>';var chitietphuluc_id = '<s:property value="json.chitietphuluc_id"/>';function loadHistory() {	history.loading();	$.ajax({		url: "${lichSuPhuLucURL}",		data: {id:phuluc_id,p:history.page},		cache: false,		success: function(response){			history.loading(false);			if(response.status == 0) {				$("ul#history").append("<li class='error'>Có lỗi xảy ra khi load lịch sử phụ lục</li>");			} else {				$.each(response.data,function(){					var msg = '[ '+this.timeaction + " ] : ";					this.useraction = "<b>"+this.useraction+"</b>";					switch(this.action) {						case "1" : 							msg += this.useraction + " tạo mới phụ lục.";							break;						case "3" : 							msg += this.useraction + " xóa phụ lục.";							break;						case "2" : 							msg += this.useraction + " cập nhật phụ lục.";							break;						case "4" : 							var data = this.info[0];							msg += ' bị thay thế bởi phụ lục <a target="_blank" href="${detailPhuLucURL}?id='+data.id+'">'+data.tenphuluc+'</a>';							break;						case "5" : 							var data = this.info[0];							msg += this.useraction + ' kê khai hồ sơ thanh toán. (<a target="_blank" href="${detailThanhToanURL}?id='+data.id+'">'+data.sohoso+'</a>)';							break;						case "6" : 							var data = this.info[0];							msg += this.useraction + ' cập nhật trạng thái thanh toán. (đã thanh toán đến '+data.thang+'/'+data.nam+')';							break;					}					$("ul#history").append("<li>"+msg+"</li>");				});				history.page++;				//debugger;				if(response.data.length < response.LS_MAX_PAGE_LENGHT) {					$("span#load_more").hide();				}			}		}	});}function addRow(stt,data) {	oTable.fnAddData([		stt,'<a href="${detailTuyenKenhURL}?id='+data.id+'" title="Xem chi tiết tuyến kênh" target="_blank">'+data.id+'</a>',data.madiemdau,data.madiemcuoi,data.loaigiaotiep,data.dungluong,data.soluong	]);}$(document).ready(function() {	if(chitietphuluc_id!='') {		oTable = $('#dataTable').dataTable({			"bJQueryUI": true,			"bProcessing": false,			"bScrollCollapse": true,			"bAutoWidth": true,			"bSort":false,			"bFilter": false,"bInfo": false,			"bPaginate" : false,			"sAjaxSource": "${findTuyenKenhByChiTietPhuLucURL}?id="+chitietphuluc_id,			"aoColumns": null,			"fnServerData": function ( sSource, aoData, fnCallback ) {				$.ajax( {					"dataType": 'json', 					"type": "POST", 					"url": sSource, 					"data": aoData, 					"success": function(response){						if(response.result == "ERROR") {							alert("Lỗi kết nối server, vui lòng thử lại.");						} else {							if(response.data.length != 0) {								var i = 0;								$.each(response.data,function(){									addRow(i,this);									i++;								});							} else {								oTable.fnAddData([0,'','','','','','','','','']);								oTable.fnDeleteRow(0);							}						}					}				} );			}		});	}	$(".number").formatCurrency({ 		region : 'vn',		roundToDecimalPlace: 0, 		eventOnDecimalsEntered: true 	});	loadHistory();	history.init();});</script>