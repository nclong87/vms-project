----------------------------------------------------------  DDL for Procedure SEND_EMAIL--------------------------------------------------------set define off;  CREATE OR REPLACE PROCEDURE "THUEKENH"."SEND_EMAIL" (p_tuyenkenh_id IN VARCHAR2, p_type IN NUMBER,p_content IN CLOB)  ASv_email_content CLOB;v_phongban_id number;BEGIN  select phongban_id into v_phongban_id from TUYENKENH where ID = p_tuyenkenh_id;  if(p_content is null or p_content = '') then    if(p_type = 1) then -- bat dau ban giao      v_email_content := 'Tuyen kenh '||p_tuyenkenh_id|| ' : bat dau ban giao';    elsif (p_type = 2) then -- toi deadline chua ban giao      v_email_content := 'Tuyen kenh '||p_tuyenkenh_id|| ' : da den deadline nhung chua ban giao';    elsif (p_type = 3) then -- da ban giao xong      v_email_content := 'Tuyen kenh '||p_tuyenkenh_id|| ' : da ban giao xong';    end if;  else    v_email_content := p_content;  end if;END SEND_EMAIL;/----------------------------------------------------------  DDL for Procedure SEND_SMS--------------------------------------------------------set define off;  CREATE OR REPLACE PROCEDURE "THUEKENH"."SEND_SMS" (p_tuyenkenh_id IN VARCHAR2, p_type IN NUMBER,p_content in varchar2) ASv_sms_content varchar2(140);v_phongban_id number;BEGIN  select phongban_id into v_phongban_id from TUYENKENH where ID = p_tuyenkenh_id;  if(p_content is null or p_content = '') then    if(p_type = 1) then -- bat dau ban giao      v_sms_content := 'Tuyen kenh '||p_tuyenkenh_id|| ' : bat dau ban giao';    elsif (p_type = 2) then -- toi deadline chua ban giao      v_sms_content := 'Tuyen kenh '||p_tuyenkenh_id|| ' : da den deadline nhung chua ban giao';    elsif (p_type = 3) then -- da ban giao xong      v_sms_content := 'Tuyen kenh '||p_tuyenkenh_id|| ' : da ban giao xong';    end if;  else    v_sms_content := p_content;  end if;END SEND_SMS;/----------------------------------------------------------  DDL for Procedure PROC_SCHEDULE--------------------------------------------------------set define off;  CREATE OR REPLACE PROCEDURE "THUEKENH"."PROC_SCHEDULE" AS BEGIN  for rec in (select t.ID,t.TUYENKENH_ID from TUYENKENHDEXUAT t left join TUYENKENH t1 on t.TUYENKENH_ID=t1.ID where t.NGAYHENBANGIAO < sysdate and t.TRANGTHAI = 0 and t.FLAG_SENDMAIL is null) loop    SEND_SMS(rec.TUYENKENH_ID,2);    SEND_EMAIL(rec.TUYENKENH_ID,2);    update TUYENKENHDEXUAT set FLAG_SENDMAIL = 1 where ID = rec.ID;  end loop;END PROC_SCHEDULE;/